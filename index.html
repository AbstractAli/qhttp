<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="QHttp : a light-weight and asynchronous HTTP library (both server &amp; client) in Qt5 and C++11 based on Node.js&#39; http parser." />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>QHttp</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/azadkuh/qhttp">View on GitHub</a>

          <h1 id="project_title">QHttp</h1>
          <h2 id="project_tagline">a light-weight and asynchronous HTTP library (both server &amp; client) in Qt5 and C++11 based on Node.js&#39; http parser.</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/azadkuh/qhttp/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/azadkuh/qhttp/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="qhttp" class="anchor" href="#qhttp"><span class="octicon octicon-link"></span></a>QHttp</h1>

<h3>
<a name="table-of-contents" class="anchor" href="#table-of-contents"><span class="octicon octicon-link"></span></a>Table of contents</h3>

<ul>
<li><a href="#about">About</a></li>
<li><a href="#features">Features</a></li>
<li><a href="#sample-codes">Sample codes</a></li>
<li><a href="#license">License</a></li>
</ul><h2>
<a name="about" class="anchor" href="#about"><span class="octicon octicon-link"></span></a>About</h2>

<p><a href="#table-of-contents">TOC</a></p>

<p><code>QHttp</code> is a lightweight, asynchronous and fast HTTP library, containing both server and client side classes for managing connections, parsing and building HTTP requests and responses.</p>

<ul>
<li><p>this project is inspired by <a href="https://github.com/nikhilm/qhttpserver">nikhilm/qhttpserver</a> effort to implement a Qt HTTP server. <code>QHttp</code> pushes the idea further by implementing client classes and better memory management, c++11, lambda connections, clean API, ...</p></li>
<li><p>the fantastic <a href="https://github.com/joyent/http-parser">joyent/http-parser</a> is the core parser of HTTP requests (server mode) and responses (client mode). I have tried to keep the API similar to the <a href="http://nodejs.org/api/http.html">Node.js</a>' http module.</p></li>
<li><p>the objective of <code>QHttp</code> is being light weight with a simple API for Qt developers to implement RESTful web services in private (internal) zones. for a fast c++ Json parser / builder, have a look at <a href="https://github.com/azadkuh/gason--">azadkuh/gason++</a></p></li>
</ul><h2>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h2>

<p><a href="#table-of-contents">TOC</a></p>

<ul>
<li><p>separate <code>namespace</code>s for server and client classes.</p></li>
<li><p>HTTP server classes: QHttpServer, QHttpConnection, QHttpRequest and QHttpResponse.</p></li>
<li><p>HTTP client classes: QHttpClient, QHttpRequest and QHttpResponse.</p></li>
<li><p><strong>automatic memory management</strong> of objects. Instances of connections, requests and replies will be deleted automatically when socket drops or disconnected.</p></li>
<li><p><strong>PIMPL</strong> (Private classes) to achieve better ABI compatibility and cleaner API.</p></li>
<li><p>API is quite similar to <strong>Node.js</strong> http module. have a look at <a href="#sample-codes">sample code</a>.</p></li>
<li><p>the only dependencies are: <a href="http://qt-project.org/downloads">Qt 5</a>, <a href="http://en.wikipedia.org/wiki/C%2B%2B11">c++11</a> and <a href="https://github.com/joyent/http-parser">joyent/http-parser</a></p></li>
<li><p><strong>high throughput</strong>, I have tried the <code>QHttp</code> and <a href="https://github.com/azadkuh/gason--">gason++</a> to implement a REST/Json web service on an Ubuntu VPS (dual core + 512MB ram) with peak TPS &gt; 5000 (stress test)</p></li>
<li><p>a simple benchmarking tool, implementing both a RESTful/Json server and client.</p></li>
<li><p>Tested under <strong>Linux</strong> (Ubuntu 12.04 LTS, 14.04 LTS) and <strong>OS X</strong> (10.9). Easily portable where ever Qt 5 works. I have no <strong>Windows</strong> machine (or time or interest), but this lib should work just fine under Windows, although I've not tried by myself.</p></li>
</ul><h2>
<a name="sample-codes" class="anchor" href="#sample-codes"><span class="octicon octicon-link"></span></a>Sample codes</h2>

<p><a href="#table-of-contents">TOC</a></p>

<p>a HelloWorld <strong>HTTP server</strong> by <code>QHttp</code> looks like:</p>

<div class="highlight highlight-cpp"><pre><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">QCoreApplication</span> <span class="n">app</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>

    <span class="k">using</span> <span class="k">namespace</span> <span class="n">qhttp</span><span class="o">::</span><span class="n">server</span><span class="p">;</span>

    <span class="n">QHttpServer</span> <span class="n">server</span><span class="p">(</span><span class="o">&amp;</span><span class="n">app</span><span class="p">);</span>
    <span class="c1">// listening on 0.0.0.0:8080</span>
    <span class="n">server</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="n">QHostAddress</span><span class="o">::</span><span class="n">Any</span><span class="p">,</span> <span class="mi">8080</span><span class="p">,</span> <span class="p">[](</span><span class="n">QHttpRequest</span><span class="o">*</span> <span class="n">req</span><span class="p">,</span> <span class="n">QHttpResponse</span><span class="o">*</span> <span class="n">res</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">res</span><span class="o">-&gt;</span><span class="n">setStatusCode</span><span class="p">(</span><span class="n">qhttp</span><span class="o">::</span><span class="n">ESTATUS_OK</span><span class="p">);</span>      <span class="c1">// status 200</span>
        <span class="n">res</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="s">"connection"</span><span class="p">,</span> <span class="s">"close"</span><span class="p">);</span>      <span class="c1">// it's the default header, this line can be omitted.</span>
        <span class="n">res</span><span class="o">-&gt;</span><span class="n">end</span><span class="p">(</span><span class="s">"Hello World!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>                 <span class="c1">// response body data</span>

        <span class="c1">// when "connection: close", the req and res will be deleted automatically.</span>
    <span class="p">});</span>


    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">server</span><span class="p">.</span><span class="n">isListening</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"failed. can not listen at port 8080!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// application's main event loop</span>
    <span class="k">return</span> <span class="n">app</span><span class="p">.</span><span class="n">exec</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>to request weather information by <strong>HTTP client</strong>:</p>

<div class="highlight highlight-cpp"><pre><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">QCoreApplication</span> <span class="n">app</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">qhttp</span><span class="o">::</span><span class="n">client</span><span class="p">;</span>

    <span class="n">QHttpClient</span>  <span class="n">client</span><span class="p">(</span><span class="o">&amp;</span><span class="n">app</span><span class="p">);</span>
    <span class="n">QByteArray</span>   <span class="n">httpBody</span><span class="p">;</span>

    <span class="n">QUrl</span> <span class="n">weatherUrl</span><span class="p">(</span><span class="s">"http://api.openweathermap.org/data/2.5/weather?q=tehran,ir&amp;units=metric&amp;mode=xml"</span><span class="p">);</span>

    <span class="n">client</span><span class="p">.</span><span class="n">request</span><span class="p">(</span><span class="n">qhttp</span><span class="o">::</span><span class="n">EHTTP_GET</span><span class="p">,</span> <span class="n">weatherUrl</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">httpBody</span><span class="p">](</span><span class="n">QHttpResponse</span><span class="o">*</span> <span class="n">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// response handler, called when the HTTP headers of the response are ready</span>

        <span class="c1">// gather HTTP response data</span>
        <span class="n">res</span><span class="o">-&gt;</span><span class="n">onData</span><span class="p">([</span><span class="o">&amp;</span><span class="n">httpBody</span><span class="p">](</span><span class="k">const</span> <span class="n">QByteArray</span><span class="o">&amp;</span> <span class="n">chunk</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">httpBody</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="c1">// called when all data in HTTP response have been read.</span>
        <span class="n">res</span><span class="o">-&gt;</span><span class="n">onEnd</span><span class="p">([</span><span class="o">&amp;</span><span class="n">httpBody</span><span class="p">]()</span> <span class="p">{</span>
            <span class="c1">// print the XML body of the response</span>
            <span class="n">puts</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">[incoming response:]"</span><span class="p">);</span>
            <span class="n">puts</span><span class="p">(</span><span class="n">httpBody</span><span class="p">.</span><span class="n">constData</span><span class="p">());</span>
            <span class="n">puts</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>

            <span class="n">QCoreApplication</span><span class="o">::</span><span class="n">instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">quit</span><span class="p">();</span>
        <span class="p">});</span>

        <span class="c1">// just for fun! print headers:</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">[Headers:]"</span><span class="p">);</span>
        <span class="k">const</span> <span class="n">qhttp</span><span class="o">::</span><span class="n">THeaderHash</span><span class="o">&amp;</span> <span class="n">hs</span> <span class="o">=</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">headers</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span> <span class="k">auto</span> <span class="n">cit</span> <span class="o">=</span> <span class="n">hs</span><span class="p">.</span><span class="n">constBegin</span><span class="p">();</span> <span class="n">cit</span> <span class="o">!=</span> <span class="n">hs</span><span class="p">.</span><span class="n">constEnd</span><span class="p">();</span> <span class="n">cit</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"%s : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">cit</span><span class="p">.</span><span class="n">key</span><span class="p">().</span><span class="n">constData</span><span class="p">(),</span> <span class="n">cit</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">constData</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">});</span>


    <span class="k">return</span> <span class="n">app</span><span class="p">.</span><span class="n">exec</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p><a href="#table-of-contents">TOC</a></p>

<p>Distributed under the MIT license. Copyright (c) 2014, Amir Zamani.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">QHttp maintained by <a href="https://github.com/azadkuh">azadkuh</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
